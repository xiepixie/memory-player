@import "tailwindcss";
@plugin "daisyui" { themes: winter, night --default, pastel, autumn, dim, sunset };

@keyframes toc-highlight {
  0% {
    /* 统一覆盖整行标题，避免中心比边缘更深 */
    background-color: color-mix(in srgb, var(--color-primary) 10%, transparent);
    transform: scale(1.01);
  }
  40% {
    /* 平滑减弱到更浅的统一色，而不是靠阴影制造光圈 */
    background-color: color-mix(in srgb, var(--color-primary) 4%, transparent);
    transform: scale(1.01);
  }
  100% {
    background-color: transparent;
    transform: scale(1);
  }
}

.toc-target-highlight {
  animation: toc-highlight 2s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  border-radius: 6px;
  transform-origin: left center;
}

@keyframes cloze-flash {
  0% {
    box-shadow: 0 0 0 0 var(--color-primary);
  }
  15% {
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-primary) 50%, transparent);
  }
  85% {
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-primary) 50%, transparent);
  }
  100% {
    box-shadow: 0 0 0 0 var(--color-primary);
  }
}

.cloze-target-highlight {
    animation: cloze-flash 1.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    border-radius: 4px;
    /* PERFORMANCE: GPU acceleration for transform */
    will-change: box-shadow;
    /* Limit style recalculation scope */
    contain: style;
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: color-mix(in srgb, var(--color-base-content) 10%, transparent);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: color-mix(in srgb, var(--color-base-content) 20%, transparent);
}

::-webkit-scrollbar-corner {
  background: transparent;
}

/* Custom scrollbar class - uses the global scrollbar styles */
.custom-scrollbar {
  scrollbar-width: thin;
  scrollbar-color: color-mix(in srgb, var(--color-base-content) 15%, transparent) transparent;
}

/* Hide scrollbar completely */
.no-scrollbar {
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* IE and Edge */
}
.no-scrollbar::-webkit-scrollbar {
  display: none; /* Chrome, Safari, Opera */
}

.mask-linear-fade {
  mask-image: linear-gradient(to right, transparent, black 10px, black calc(100% - 10px), transparent);
  -webkit-mask-image: linear-gradient(to right, transparent, black 10px, black calc(100% - 10px), transparent);
}

/* ===== Display Math Styling ($$...$$) ===== */
/* Unified container styling for all display math blocks */
.katex-display {
  /* Container styling */
  display: block;
  margin: 1.5rem 0;
  padding: 1rem 1.5rem;
  background: color-mix(in srgb, var(--color-base-200) 40%, transparent);
  border: 1px solid color-mix(in srgb, var(--color-base-300) 60%, transparent);
  border-radius: 0.5rem;
  overflow-x: auto;
  
  /* Performance optimization */
  contain: layout style;
}

/* Sticky note: Override display math styling for compact appearance */
.sticky-note-content .katex-display {
  margin: 0;
  padding: 0;
  background: transparent;
  border: none;
  border-radius: 0;
  overflow-x: visible;
  contain: none;
}

/* NOTE: Hover effects removed from regular display math.
   Only MathClozeBlock (挖空公式) should have interactive hover styles.
   This is handled by the MathClozeBlock component directly. */

/* ===== Performance Optimizations for Long Math Documents ===== */

/* Cloze performance: Contain layout to prevent reflow cascade */
[data-cloze-key] {
  contain: layout;
}

/* Math cloze blocks: Isolate repaint boundaries */
.math-cloze-block {
  contain: layout style; /* Removed paint to allow ring/shadow overflow */
  isolation: isolate;
}

/* Optimize scrolling containers for long documents */
#note-scroll-container {
  /* GPU acceleration for smooth scrolling */
  transform: translateZ(0);
  /* Reduce repaint area during scroll */
  will-change: scroll-position;
}

/* Reduce layout thrashing during hover state changes */
.group:hover {
  will-change: background-color, border-color;
}

/* ===== Animation Optimization: CSS-based animations ===== */
/* Replacing Framer Motion for simple transitions to avoid React re-renders */

/* Dropdown/Popover animations */
.dropdown-enter {
  transition: opacity 200ms ease-out, transform 200ms ease-out;
}

.dropdown-open {
  opacity: 1;
  transform: translateY(0) scale(1);
  pointer-events: auto;
}

.dropdown-closed {
  opacity: 0;
  transform: translateY(8px) scale(0.96);
  pointer-events: none;
}

/* Fade + slide animations for list items */
@keyframes fade-slide-in {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-slide-in {
  animation: fade-slide-in 150ms ease-out both;
}

/* Stagger delay utilities */
.stagger-1 { animation-delay: 0ms; }
.stagger-2 { animation-delay: 30ms; }
.stagger-3 { animation-delay: 60ms; }
.stagger-4 { animation-delay: 90ms; }
.stagger-5 { animation-delay: 120ms; }

/* Welcome screen blob animations - GPU accelerated */
@keyframes blob-float-1 {
  0%, 100% { transform: scale(1) rotate(0deg); }
  50% { transform: scale(1.1) rotate(10deg); }
}

@keyframes blob-float-2 {
  0%, 100% { transform: scale(1) rotate(0deg); }
  50% { transform: scale(1.2) rotate(-15deg); }
}

.blob-animated-1 {
  animation: blob-float-1 20s ease-in-out infinite;
  will-change: transform;
}

.blob-animated-2 {
  animation: blob-float-2 25s ease-in-out infinite;
  will-change: transform;
}

/* Header entry animation */
@keyframes header-slide-down {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-header-entry {
  animation: header-slide-down 400ms ease-out both;
}

/* Content entry animations */
@keyframes content-fade-up {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-content-entry {
  animation: content-fade-up 500ms cubic-bezier(0.32, 0.72, 0, 1) both;
}

.animate-content-entry-delayed {
  animation: content-fade-up 600ms cubic-bezier(0.32, 0.72, 0, 1) both;
  animation-delay: 200ms;
}

/* Card entry animation */
@keyframes card-entry {
  from {
    opacity: 0;
    transform: translateY(12px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-card-entry {
  animation: card-entry 400ms cubic-bezier(0.25, 0.1, 0.25, 1) both;
  animation-delay: calc(var(--entry-delay, 0) * 1ms);
}

/* Loading spinner animation */
@keyframes loading-pulse-rotate {
  0% {
    transform: scale(1) rotate(0deg);
    opacity: 0.5;
  }
  50% {
    transform: scale(1.2) rotate(180deg);
    opacity: 1;
  }
  100% {
    transform: scale(1) rotate(360deg);
    opacity: 0.5;
  }
}

.animate-loading-spinner {
  animation: loading-pulse-rotate 3s ease-in-out infinite;
  will-change: transform, opacity;
}

/* Login page blob animations */
@keyframes blob-float-login-1 {
  0%, 100% { transform: scale(1) translate(0, 0); }
  50% { transform: scale(1.1) translate(20px, -20px); }
}

@keyframes blob-float-login-2 {
  0%, 100% { transform: scale(1) translate(0, 0); }
  50% { transform: scale(1.2) translate(-30px, 30px); }
}

.blob-animated-login-1 {
  animation: blob-float-login-1 8s ease-in-out infinite;
  will-change: transform;
}

.blob-animated-login-2 {
  animation: blob-float-login-2 10s ease-in-out infinite 1s;
  will-change: transform;
}

/* === CodeMirror 6 Layout Styles === */
.cm-editor-wrapper {
  height: 100%;
  display: flex;
  flex-direction: column;
}

.cm-editor-wrapper .cm-editor {
  flex: 1;
  height: 100%;
  overflow: hidden;
}

.cm-editor-wrapper .cm-scroller {
  overflow: auto !important;
}
